!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports._prohibitedMonitor=t():e._prohibitedMonitor=t()}(this,(function(){return function(){"use strict";var e={d:function(t,n){for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{default:function(){return H}});const n=/([^{]+)({.+})?/,o=/^{|}$/g,r=/^['"]|['"]$/g,s=/\/\/([^/]+)\//;var i={serializeParams(e){const t=[],n=Object.keys(e);for(let o=0,r=n.length;o<r;o++){const r=n[o];t.push(`${encodeURIComponent(r)}=${encodeURIComponent(e[r])}`)}return t.join("&")},getUrlDomain(e){const t=e.match(s);return t?t[1]:""},getUrlQuery(e){return this.getParsedUrl(window.location.href).searchParams.get(e)||""},getParsedUrl(e){return new URL(e)},getChannelIdByUserAgent(){var e,t;const n=null===(e=window.navigator.userAgent)||void 0===e||null===(t=e.match)||void 0===t?void 0:t.call(e,/channelId\/(\w+)/);return null==n?void 0:n[1]},getChannelContext(e){const t={channelId:"",referralSrc:""};if(!e)return t;let n="",o="";if(e.searchParams.forEach(((e,t)=>{const r=t.toLowerCase();"channelid"===r&&(n=e),"channelflag"===r&&(o=e)})),t.channelId=n||o,t.channelId)return t;const r="/join";if(e.pathname.endsWith(r))return t;if(!e.pathname.includes(r))return t;const s=e.pathname.split(`${r}/`)[1];if(!s)return t;const i=s.split("/")[0];if(i.startsWith("-"))return t;const a=i.split("-"),c=a[a.length-2]||"";return n=a[a.length-1],n&&(t.referralSrc=c,t.channelId=n),t},getOriginalUrl(e){return e.replace(/([?&])t=\d+(&)?/,((e,t,n)=>t&&n?t===n?"&":"?":""))},setCookie(e,t,n){const o=new Date;o.setTime(o.getTime()+n),document.cookie=`${e}=${encodeURIComponent(t)};expires=${o.toGMTString()};path=/`},getCookie(e){const t=new RegExp(`(^| )${e}=([^;]*)(;|$)`),n=document.cookie.match(t);return n?decodeURIComponent(n[2]):""},parseTarget(e){const t=e.match(n),s={key:"",data:{}};if(t){const e=t[1],n=t[2],i={};if(n){n.replace(o,"").split(",").forEach((e=>{let t=e.split(":");t=t.map((e=>e.trim().replace(r,"")));const[n,o]=t;i[n]=o}))}s.key=e,s.data=i}return s},matchType(e,t){return Object.prototype.toString.call(e)===`[object ${t}]`},isArray(e){return this.matchType(e,"Array")},isObject(e){return this.matchType(e,"Object")},isInArray(e,t){if(Array.prototype.includes)return e.includes(t);for(let n=0,o=e.length;n<o;n++)if(e[n]===t)return!0;return!1},generateUUID(){let e=Date.now()+window.performance.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))},valueExists(e){return null!=e&&""!==e},passedNamingCheck(e){return!/[^a-z0-9_]/.test(e)},toFixed(e){return Number(e.toFixed(4))},toUnderLineFormat(e){return e.replace(/([A-Z])/g,((e,t,n)=>0===n?`${t.toLowerCase()}`:`_${t.toLowerCase()}`))},filterXSS(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&#34;")},merge(e,t){const n={};return Object.keys({...e,...t}).forEach((o=>{var r;null==t[o]&&null==e[o]||(n[o]=null!==(r=t[o])&&void 0!==r?r:e[o])})),n},base64Id(){let e="";for(let t=0;t<22;++t)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".charAt(Math.floor(64*Math.random()));return e},isTargetingCookiesRejected(){if("undefined"==typeof window)return!1;if(void 0===window.OnetrustActiveGroups)return!1;try{return!window.OnetrustActiveGroups.includes("C0004")}catch(e){return!1}}};var a=function(e){let t;const n=new Set,o=(e,o)=>{const r="function"==typeof e?e(t):e;if(r!==t){const e=t;t=(null!=o?o:"object"!=typeof r)?r:Object.assign({},t,r),n.forEach((n=>n(t,e)))}},r=()=>t,s={setState:o,getState:r,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>n.clear()};return t=e(o,r,s),s}((e=>({deviceId:"",needDurationActions:[],needDurationActionParams:{},actionTriggerTimes:{},setDeviceId:t=>e((()=>({deviceId:t}))),setNeedDurationActions:t=>e((()=>({needDurationActions:t}))),setNeedDurationActionParams:t=>e((()=>({needDurationActionParams:t}))),setActionTriggerTimes:t=>e((()=>({actionTriggerTimes:t})))})));const c="okex",l="undefined"!=typeof window,d=Boolean("undefined"==typeof window||"undefined"!=typeof process&&{NODE_ENV:"production",ASSETS_BUILD_TYPE:"publish",ASSETS_BUILD_VERSION:"2.6.82"}.SSR_ENV),g=!!l&&/OKApp\/\(\S+\/\S+\)/i.test(navigator.userAgent);let u=!0,p={_expires:{}},m={};if(l){m=window._okGlobal||window.okGlobal||{};const e=m.broker&&m.broker.is,t="1"===localStorage.simulatedTrading,{okjp:n}=m.site&&m.site.is||{};u=e||t||!0===n;const{ok_monitor:o='{ "_expires": {} }'}=localStorage;p=JSON.parse(o)}const h={};var f={setEnv(e){var t,n;const{screen:o}=window,{_tk:r}=localStorage,s=null===(t=window.utils.ont)||void 0===t||null===(n=t.getDeviceId)||void 0===n?void 0:n.call(t),{deviceId:c}=a.getState(),{systemLanguage:l,language:d}=navigator;let{referrer:g}=document;h.site=this.getSiteInfo(),h.lcl=i.getCookie("locale"),g&&(g.length>256&&(g=g.substr(0,256)),h.rf=g),r&&(h.tk=r),h.uid=c||s,h.lan=(l||d).toLowerCase();let u="0x0";if(o){const{width:e,height:t}=o;u=`${e}x${t}`}h.scr=u;let p=i.getCookie("first_ref");p&&(p.length>256&&(p=p.substr(0,256)),h.frf=p)},getEnv(){return h},isInApp(){return g},toLocalStorage(e){let{key:t,value:n,maxAge:o}=e;p[t]=n,p._expires[t]=Date.now()+o,localStorage.ok_monitor=JSON.stringify(p)},removeLocalStorage(e){delete p[e],delete p._expires[e],localStorage.ok_monitor=JSON.stringify(p)},getClientValue(e){const t=sessionStorage.getItem(e);return t||this.getValueFromLocalStorage(e)},getValueFromLocalStorage(e){return Date.now()<p._expires[e]&&p[e]||""},syncUpLocalStorageToSessionStorage(e){if(sessionStorage.getItem(e))return;const t=this.getValueFromLocalStorage(e);t&&sessionStorage.setItem(e,t)},shouldIgnoreAmpEvent(){return u},__getOkGlobalSite(){return m.site||{}},__getOkGlobalSiteIs(){return this.__getOkGlobalSite().is||{}},getSiteInfo(){return this.isOKExTR()?"okx_tr":this.__getOkGlobalSite().sign||c},isOKExTR(){return!0===this.__getOkGlobalSiteIs().TR},isOKExGlobal(){return this.__getOkGlobalSite().sign===c},isOKEx(){return this.isOKExGlobal()||this.isOKExTR()},isOKLink(){const e=this.__getOkGlobalSite();return"oklink"===e.sign||e.sign===c&&e.linkInOKX},isInSSR(){return d},isInBrowser(){return l},isInExtension(){return window.inOKXExtension||window.inUIOKXExtension},isInDesktop(){var e;return null===(e=window)||void 0===e||null===(e=e.navigator)||void 0===e||null===(e=e.userAgent)||void 0===e||null===(e=e.toLocaleLowerCase())||void 0===e?void 0:e.includes("electron/")},isDevTestEnv(){return this.isInExtension()?"publish"!==window.ASSETS_BUILD_TYPE:["pre","prod"].indexOf(m.envSign)<0},isProdEnv(){return this.isInExtension()?"publish"===window.ASSETS_BUILD_TYPE:"prod"===m.envSign},getOkGlobal(){return m},isEnableAMP(){return this.isProdEnv()||"true"===sessionStorage.getItem("monitor_amplitude_enable_for_test")},getTk(){return g&&window.jsbridge?window.jsbridge.getTK().then((e=>e||(localStorage._tk||""))).catch((()=>{})):Promise.resolve(localStorage._tk||"")}};let _="";if(f.isInBrowser()){const{cdnBaseUrl:e="//static.coinall.ltd"}=f.getOkGlobal();_=e}const v={okx:"okx",oklink:"oklink",web3:"web3",okcoin:"okcoin"};var S={Actions:{CLICK:"clk",EXPOSE:"xps"},Configs:{ATTR_CLICK:"data-clk",ATTR_EXPOSE:"data-xps",ATTR_LISTEN:"data-lsn",EXPOSE_DURATION:500},REQUEST_LONG_WAIT_TIME:1e3,PERF_REPORT_DEFER_TIME:5e3,AMPLITUDE_PROJECT:v,AMPLITUDE_KEY_MAP:{[v.okx]:{prod:"56bf9d43d57f079e506b4f26c70a698f",dev:"1baf4c48da921e60512f74d455f02da8"},[v.oklink]:{prod:"d77757dff7616a060069e378595de0f7",dev:"d77757dff7616a060069e378595de0f7"},[v.web3]:{prod:"669cbf122dec17ceb8e68a78c8240d24",dev:"2f69d358792107218343f78d2488e305"},[v.okcoin]:{prod:"21c676d501be3d648464d7ae0038cd53",dev:"69ec37219ff98b032d9e1a1d3bd81de7"}},CDN_BASE_URL:_,MILLISECONDS_OF_30_DAYS:2592e6,YESTERDAY:-864e5,WEB3CATEGORY:["onchain","web3_homepage","wallet","web3_trade","nft","web3_discover","web3_invest","okc","onchain_data"]};const I=[{keyword:"baidu.com",type:"BaiduSEO"},{keyword:"google",type:"GoogleSEO"},{keyword:"yandex.com",type:"yandexSEO"},{keyword:"yahoo",type:"yahooSEO"},{keyword:"so.com",type:"360SEO"},{keyword:"bing.com",type:"bingSEO"},{keyword:"sogou.com",type:"sogouSEO"},{keyword:"m.sm.cn",type:"smSEO"},{keyword:"naver.com",type:"naverSEO"}];var E={getSeoType(){const e=i.getUrlDomain(document.referrer);for(let t=0;t<I.length;t++){const{keyword:n,type:o}=I[t];if(e.indexOf(n)>-1)return o}return""}};const w=f.isInBrowser()?JSON.parse(localStorage.__error__||"[]"):[];var y={getErrorInfo(e){const{message:t,filename:n,lineno:o,colno:r,error:s}=e;let i="";s&&s.stack?(i=s.stack,-1!==i.indexOf("@")&&(i=`${t} \n\r ${i}`)):(s||t)&&(i=`ThrowError: ${JSON.stringify(s||t)} \n\r at ${n}: ${o}: ${r}`);return{msg:t,file:n,line:o,col:r,stack:i,url:encodeURIComponent(window.location.href)}},isReported(e){let{file:t,line:n,col:o}=e;const r=`${t}__${n}__${o}`;return w.includes(r)},rememberError(e){let{file:t,line:n,col:o}=e;const r=`${t}__${n}__${o}`;w.unshift(r),w.length>50&&w.pop(),setTimeout((()=>{localStorage.__error__=JSON.stringify(w)}),0)}};var b=function(e,t){let n=null!==t?(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{expirationDays:365}).expirationDays:-1;if(n){const e=new Date;e.setTime(e.getTime()+24*n*60*60*1e3),n=e}let o=`${e}=${t}`;n&&(o+=`; expires=${n.toUTCString()}`),o+="; path=/",document.cookie=o},k=e=>{try{const t=document.cookie.split(";");let n=null;for(let o=0;o<t.length;o++){let r=t[o];for(;" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(e)){n=r.substring(e.length+1,r.length);break}}return n}catch(e){return null}};let T=null,O=!1;class A{constructor(e){f.setEnv(e)}logPV(){if(!O){const e={_act:"_pv",_ct:"_pv",_action_type:"Show",_element_type:"Page",...this._getCommonData()};this.sendLogs(e),O=!0}}logEvent(e){const t={},{category:n,action:o,target:r,params:s,extras:a,_m:c,anchor:l,elementType:d,actionType:g,tk:u}=e;if(Object.assign(t,{_ct:n,_act:o,_lb:encodeURIComponent(r||""),_anchor_en_name:encodeURIComponent(l||""),_element_type:encodeURIComponent(d||""),_action_type:encodeURIComponent(g||""),...this._getCommonData()}),t._tk=u||t._tk,i.isArray(s)){let e=0,n=0;s.forEach(((o,r)=>{if(i.isObject(o)){const{value:r,random:s}=o,i=encodeURIComponent(r);s?t["_unlist"+n++]=i:t["_reser"+e++]=i}else t[`_reser${r}`]=encodeURIComponent(o)}))}else if(i.valueExists(s)){let e=s;i.isObject(s)&&(e=JSON.stringify(s));const n=encodeURIComponent(e);t._v=n,t._reser0=n}if(a){a.page=encodeURIComponent(window.location.href);const e={};Object.keys(a).forEach((t=>{e[`__${t}`]=a[t]})),Object.assign(t,e)}return c&&(t._m=c),this.sendLogs(t)}_getCommonData(){const e={...f.getEnv()};localStorage._tk&&(e.tk=localStorage._tk);const{src:t,sessionId:n=""}=sessionStorage,o=f.getClientValue("pageId"),r=f.getClientValue("channelId"),{deviceId:s=i.base64Id(),eventId:a=1,sequenceNumber:c=1}=JSON.parse(k("_monitor_extras")||"{}");b("_monitor_extras",JSON.stringify({deviceId:s,eventId:a+1,sequenceNumber:c+1}));const l=JSON.stringify({_amp_rejected:i.isTargetingCookiesRejected(),_device_id:s,_event_id:a,_sequence_number:c,_uuid:i.generateUUID()}),d={_cid:r,_pgid:o,_source:t,_session_id:encodeURIComponent(n.slice(0,256)),_page_url:encodeURIComponent(window.location.href.slice(0,256)),_extras:l};return Object.keys(e).forEach((t=>{d[`_${t}`]=encodeURIComponent(e[t])})),d}sendLogs(e){const t=[];if(Object.keys(e).forEach((n=>{const o=e[n];i.valueExists(o)?t.push(`${n}=${o}`):delete e[n]})),f.isDevTestEnv()){const{console:t}=window;return t.groupCollapsed(`dev monitor: ${e._ct} > ${e._act}`),t.log(decodeURIComponent(JSON.stringify(e,null,2))),t.groupEnd(),Promise.resolve()}return f.isInApp()&&window.jsbridge?window.jsbridge.getTK().then((e=>{if(e){const n=`_tk=${encodeURIComponent(e)}`,o=t.findIndex((e=>/^_tk/.test(e)));o>-1?t[o]=n:t.push(n)}return this.addClientInfo(t.join("&"))})).catch((()=>this.addClientInfo(t.join("&")))):this.addClientInfo(t.join("&"))}addClientInfo(e){const t=`&_ts=${Date.now()}&_r=${Math.floor(2147483648*Math.random())}`;let n=`?${e}${t}`;return f.isInApp()&&window.jsbridge?window.jsbridge.getClientInfo().then((o=>{const r=o?`&_app_info=${encodeURIComponent(o)}`:"";return n=`?${e}${r}${t}`,this.sendRequest(n)})).catch((e=>this.sendRequest(n))):this.sendRequest(n)}sendRequest(e){return new Promise((t=>{if(navigator.sendBeacon&&!f.isInExtension())navigator.sendBeacon(`/jsstat/${f.isOKLink()?"oklink":"sb"}${e}`),t();else{let n=!1;const o=new Image;o.onload=()=>{n||(t(),n=!0)},o.src=f.isInExtension()?`https://www.oklink.com/jsstat/s.gif${e}`:`/jsstat${f.isOKLink()?"/oklink":""}/s.gif${e}`,setTimeout((()=>{n||(t(),n=!0)}),150)}}))}}const{Actions:x,Configs:C}=S;var P={listen(e,t){document.addEventListener("click",(n=>{const{target:o}=n;o.getAttribute(C.ATTR_LISTEN)&&t.preprocess();const r=o.getAttribute(C.ATTR_CLICK);if(r){const t=i.parseTarget(r),{key:n,data:o}=t;n&&e({target:n,action:x.CLICK,params:o,extras:{area:o.area}})}}))}};const U={},{Actions:R,Configs:D}=S;var L={listen(e){this.trackFn=e;const t=new window.IntersectionObserver(this.onSectionChange.bind(this),{threshold:[.5,1]});document.querySelectorAll(`[${D.ATTR_EXPOSE}]`).forEach((e=>{t.observe(e)})),this.observer=t},onSectionChange(e){e.forEach((e=>{const{target:t,isIntersecting:n}=e,o=t.getAttribute(D.ATTR_EXPOSE),r=i.parseTarget(o),{key:s,data:a}=r,c=Number(e.time.toFixed(2));if(n){const e=setTimeout((()=>{const e=U[s],n=t.getBoundingClientRect(),{innerHeight:o,innerWidth:r}=window,{top:i,bottom:l,left:d,right:g}=n;if((i>=0&&i<=o||l>=0&&l<=o)&&(d>=0&&d<=r||g>=0&&g<=r)){const{area:n,elementType:o,actionType:r}=a;delete a.area,delete a.elementType,delete a.actionType,this.trackFn({target:s,action:R.EXPOSE,params:{...a,time:c},extras:{area:n},actionType:r||"Show",elementType:o,anchor:o?s:""}),this.observer.unobserve(t),e.forEach((e=>{window.clearTimeout(e)})),delete U[s]}else e.shift()}),D.EXPOSE_DURATION);U[s]||(U[s]=[]),U[s].push(e)}}))}};const{Configs:j}=S;var $={listen(e){const t=t=>{e.logEvent({...t,category:"ok"})};this.preprocess(),P.listen(t,this),L.listen(t,this)},preprocess(){document.querySelectorAll(`[${j.ATTR_LISTEN}]`).forEach((e=>{const t=e.getAttribute(j.ATTR_LISTEN),n=t.indexOf(":");if(n>-1){const o=t.substring(0,n).trim(),r=t.substring(n+1).trim();o.split("+").forEach((t=>{e.setAttribute(`data-${t.trim()}`,r)})),e.removeAttribute(j.ATTR_LISTEN)}}))}};var N=class{constructor(){this.listeners={}}on(e,t,n){let o=[];const r=arguments.length;for(let e=0;e<r;e++)o.push(arguments[e]);o=o.length>3?o.splice(3,o.length-1):[],void 0!==this.listeners[e]?this.listeners[e].push({scope:n,callback:t,args:o}):this.listeners[e]=[{scope:n,callback:t,args:o}]}remove(e,t,n){if(void 0!==this.listeners[e]){const o=this.listeners[e].length,r=this.listeners[e].slice(0);for(let s=0;s<o;s++){const o=r[s];o.scope==n&&o.callback==t&&this.listeners[e].splice(s,1)}}}has(e,t,n){if(void 0!==this.listeners[e]){const o=this.listeners[e].length;if(void 0===t&&void 0===n)return o>0;for(let r=0;r<o;r++){const o=this.listeners[e][r];if((!n||o.scope==n)&&o.callback==t)return!0}}return!1}emit(e){if(void 0!==this.listeners[e]){const r=this.listeners[e].slice(),s=r.length;for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];for(let e=0;e<s;e++){const t=r[e];if(t&&t.callback){const e=n.concat(t.args);t.callback.apply(t.scope,e)}}}}};const K=e=>{var t;const{amplitude:n}=window;if(!n)return!1;const o=n.getInstance(e);return null==o||null===(t=o.options)||void 0===t?void 0:t.apiKey},B=e=>{const{signUpCompleted:t}=sessionStorage;t&&(e.logEvent("signup_completed"),sessionStorage.removeItem("signUpCompleted"))},G=e=>e||(f.isOKLink()?S.AMPLITUDE_PROJECT.oklink:f.isOKEx()||f.isInExtension()?S.AMPLITUDE_PROJECT.okx:S.AMPLITUDE_PROJECT.okcoin);let M;const q="RESOLVE",J="REJECT",V={__initQueue__:Promise.resolve(!0),events:new N,getAmplitudeSDKInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new Promise(((t,n)=>{this.events.on(q,(e=>{t(e)})),this.events.on(J,(e=>{n(e)})),this.getInstance(e)}))},getInstance(e){const t=G(e);return M&&clearTimeout(M),new Promise(((e,n)=>{if(!K(t))return void(this.__initQueue__=this.__initQueue__.then((()=>this.__initInstance__(t))).then((t=>{e(t)})).catch((e=>{n(e)})));const{amplitude:o}=window;if(o){const n=o.getInstance(t);B(n),n.options&&this.events.emit(q,n),e(n)}}))},__initInstance__(e){const t=G(e);return new Promise((e=>{window.amplitude||function(){const{envSign:e,cdnBaseUrl:t}=f.getOkGlobal(),n=window.amplitude||{_q:[],_iq:{}},o=document.createElement("script");o.type="text/javascript",o.crossOrigin="anonymous",o.async=!0;let r="";switch(e){case"dev":r="cdndev";break;case"pre":r="cdnpre";break;default:r="cdn"}f.isInExtension()?(o.integrity="sha384-pOU6BcU7Xl8BUN1qGu7OTKvbAUHiErbL8FdKEnAhCwR47UmKCyC5mOM9Nqxe02PR",o.src="./scripts/lib/amplitude-8.2.3-min.gz.js"):t?(o.src=`${t}/${r}/assets/okfe/libs/monitor/amplitude-okx-8.21.8.min.js`,o.integrity="sha384-ATgbJ2zDjulTgephpcvQJOOMESYqq8o5Ep+hws0LXCAm9qr07fUtUfvuYN52bSGI"):(o.src="https://cdn.amplitude.com/libs/amplitude-8.21.8-min.gz.js",o.integrity="sha384-QahB0HKETlcqjneomU3Ohs+UgJTinhUNFIKJitEl2Vo7DjvphO2jei64ZP5J2GA5"),o.onload=function(){window.amplitude.runQueuedFunctions||console.log("[Amplitude] Error: could not load SDK")};const s=document.getElementsByTagName("script")[0];function i(e,t){e.prototype[t]=function(){return this._q.push([t].concat(Array.prototype.slice.call(arguments,0))),this}}s.parentNode.insertBefore(o,s);const a=function(){return this._q=[],this},c=["add","append","clearAll","prepend","set","setOnce","unset"];for(let e=0;e<c.length;e++)i(a,c[e]);n.Identify=a;const l=function(){return this._q=[],this},d=["setProductId","setQuantity","setPrice","setRevenueType","setEventProperties"];for(let e=0;e<d.length;e++)i(l,d[e]);n.Revenue=l;const g=["init","logEvent","logRevenue","setUserId","setUserProperties","setOptOut","setVersionName","setDomain","setDeviceId","enableTracking","setGlobalUserProperties","identify","clearUserProperties","setGroup","logRevenueV2","regenerateDeviceId","groupIdentify","onInit","logEventWithTimestamp","logEventWithGroups","setSessionId","resetSessionId"];function u(e){function t(t){e[t]=function(){e._q.push([t].concat(Array.prototype.slice.call(arguments,0)))}}for(let e=0;e<g.length;e++)t(g[e])}u(n),n.getInstance=function(e){return e=(e&&0!==e.length?e:"$default_instance").toLowerCase(),n._iq.hasOwnProperty(e)||(n._iq[e]={_q:[]},u(n._iq[e])),n._iq[e]},window.amplitude=n}();const n=window.amplitude.getInstance(t);if(K(t))e(n);else{const o={includeUtm:!0,includeReferrer:!0,includeGclid:!0,logAttributionCapturedEvent:!0,language:f.getOkGlobal().locale};Y.apiEndpoint?o.apiEndpoint=Y.apiEndpoint:(f.isOKEx()||f.isOKLink())&&(o.apiEndpoint=`${window.location.host}/amplitude`,o.forceHttps=!1);const r=(e=>{var t;const n=f.isProdEnv(),o=null===(t=S.AMPLITUDE_KEY_MAP)||void 0===t?void 0:t[e];return o?n?null==o?void 0:o.prod:null==o?void 0:o.dev:""})(t);n.init(r,null,o,(n=>{if(this.events.emit(q,n),((e,t)=>{const{uid:n}=f.getEnv();e.setDeviceId(n||""),t===S.AMPLITUDE_PROJECT.web3?e.setUserId(n||""):f.getTk().then((t=>{e.setUserId(t||"")}))})(n,t),sessionStorage.channelId&&n.setUserProperties({channel_id:sessionStorage.channelId}),sessionStorage.ampCacheEvents){JSON.parse(sessionStorage.ampCacheEvents).forEach((e=>{n.logEvent(...e)})),sessionStorage.ampCacheEvents=""}B(n),e(n)}))}}))}};f.isInBrowser()&&!f.shouldIgnoreAmpEvent()&&(M=setTimeout((()=>{M=0,V.getInstance()}),5e3));var F=V;let X=!1;class Y{constructor(e){f.isInSSR()||(this.commonParams=e.commonParams||{},this._logger=function(e){return T||(T=new A(e),T)}(e),this._category=e.product,e.withPV&&this._logger.logPV(),X||(this._initEventListener(),X=!0))}setApiEndpoint(e){if(/^https?:\/\//.test(e))throw new Error('The content of the URL can not include protocol type as a substring such as "http://" or "https://".');Y.apiEndpoint=e}report(e){let{type:t,value:n}=e;if(f.isInSSR())return Promise.resolve();let o=n;return(i.isObject(o)||i.isArray(o))&&(o=JSON.stringify(o)),this._logger.logEvent({category:"performance",action:t,params:o})}logPV(){this._logger.logPV()}logAmplitudeEvent(e,t,n){if(f.isInSSR()||f.shouldIgnoreAmpEvent())return Promise.resolve();let o="",r=!1;i.isObject(n)&&(o=n.ampProject,r=n.ignoreBackUp);const s={};for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(s[e]=t[e]);if(s.monitor_after_navigation){delete s.monitor_after_navigation;const t=JSON.parse(sessionStorage.ampCacheEvents||"[]");return t.push([e,s]),sessionStorage.ampCacheEvents=JSON.stringify(t),Promise.resolve()}return F.getInstance(o).then((n=>{n.logEvent(e,{...s,site:f.getSiteInfo()}),r||this.act(e,t,{isSyncAMP:!1})}))}resetAmplitudeUser(){return f.isInSSR()?Promise.resolve():F.getInstance().then((e=>(e.setUserId(null),e.regenerateDeviceId(),Promise.resolve())))}track(e,t,n,o){if(f.isInSSR())return Promise.resolve();const r={category:this._category,action:n,target:t,params:o,extras:{area:e}};if(i.isObject(e)){const{area:t,action:n,target:o,params:s}=e;Object.assign(r,{action:n,target:o,params:s,extras:{area:t}})}return this._logger.logEvent(r)}async act(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isSyncAMP:!0};if(f.isInSSR())return Promise.resolve();const{user_id:o,...r}=this.commonParams||{},s={web_mode_okx:i.isInArray(S.WEB3CATEGORY,this._category)?"wallet":"exchange"};let c,l=Object.assign({},f.isOKEx()?s:{}),d=(null==n?void 0:n.tk)||o,g={category:this._category,params:t,_m:"1"};i.isObject(t)&&(g.params=i.merge({...r,...l},t),l=i.merge(f.isOKLink()?{...r,...l}:l,t)),"string"==typeof e?(c=e,g.action=e):(c=e.action||e.anchor,g.action=c,g.anchor=e.anchor,g.actionType=e.actionType,g.elementType=e.elementType,g={...g,params:i.merge(g.params,e.params||{})},d=e.tk||d,l=i.merge(l,e.params)),g.tk=d;const{needDurationActions:u,needDurationActionParams:p,actionTriggerTimes:m,setActionTriggerTimes:h,setNeedDurationActionParams:_}=a.getState();if(f.isEnableAMP()&&null!=n&&n.isSyncAMP){const t=null==e?void 0:e.ampProject;this.logAmplitudeEvent(c,l,{ampProject:t,ignoreBackUp:!0})}return i.isInArray(u,c)?(m[c]=Date.now(),h(m),p[c]=g,_(p),Promise.resolve("The event will be reported when the page is closed")):this._logger.logEvent(g)}_initEventListener(){window.addEventListener("load",(()=>{$.listen(this._logger)})),window.addEventListener("error",(e=>{const t=y.getErrorInfo(e);y.isReported(t)||(this._logger.logEvent({category:"error",action:"report",extras:t}),y.rememberError(t))}),!0),window.addEventListener("beforeunload",(()=>{const{needDurationActions:e,needDurationActionParams:t,actionTriggerTimes:n,setNeedDurationActions:o,setNeedDurationActionParams:r,setActionTriggerTimes:s}=a.getState();e.length&&e.forEach((e=>{t[e].params.duration=Date.now()-n[e],this._logger.logEvent(t[e])})),o([]),r({}),s({})}))}initABTest(e){null!=e&&e.exper_flagKey&&null!=e&&e.exper_variant&&(Object.assign(this.commonParams,e),this.act("ab_experiment"))}setCommonParams(e){this.commonParams={...this.commonParams,...e}}triggerReportDuration(e){const{needDurationActions:t,setNeedDurationActions:n}=a.getState();i.isInArray(t,e)||(t.push(e),n(t))}}const{MILLISECONDS_OF_30_DAYS:Q}=S,W=(e,t)=>{if(f.isInSSR())return;const{pathname:n}=window.location;sessionStorage.channelId=e,f.toLocalStorage({key:"channelId",value:e,maxAge:Q}),t?(sessionStorage.referralSrc=t,f.toLocalStorage({key:"referralSrc",value:t,maxAge:Q})):(sessionStorage.removeItem("referralSrc"),f.removeLocalStorage("referralSrc")),sessionStorage.pageId=n,f.toLocalStorage({key:"pageId",value:n,maxAge:Q})};var z={monitor:{get amplitude(){return f.isInSSR()?{getAmplitudeSDKInstance(){return new Promise(((e,t)=>{t("Currently not a browser environment!")}))}}:F},newInstance(e){return f.isInSSR()?{setApiEndpoint(){},report(){return Promise.resolve()},logPV(){return Promise.resolve()},logAmplitudeEvent(){return Promise.resolve()},resetAmplitudeUser(){return Promise.resolve()},track(){return Promise.resolve()},act(){return Promise.resolve()},_initEventListener(){},initABTest(){return Promise.resolve()},setCommonParams(){},triggerReportDuration(){}}:new Y(e)},saveChannelId(e){W(e)},getChannelId(){return sessionStorage.channelId},setDeviceId(e){const{setDeviceId:t}=a.getState();t(e)},getChannelContextFromUrl(e){return i.getChannelContext(i.getParsedUrl(e))}},parseUrl(){const e=i.getParsedUrl(window.location.href),t=e.searchParams.get("src");t&&sessionStorage.setItem("src",t),this.parseChannelId(e)},parseChannelId(e){const t=i.getChannelIdByUserAgent(),n=E.getSeoType(),o=i.getChannelContext(e);let r=o.channelId,s=o.referralSrc;f.isInDesktop()&&t&&(r=t,s=""),!r&&n&&(r=n),r=i.filterXSS(r),r?W(r,s):(f.syncUpLocalStorageToSessionStorage("channelId"),sessionStorage.getItem("channelId")&&(f.syncUpLocalStorageToSessionStorage("referralSrc"),f.syncUpLocalStorageToSessionStorage("pageId")))},init(){if(!f.isInSSR()){if(this.parseUrl(),!i.getCookie("first_ref")&&document.referrer&&i.setCookie("first_ref",document.referrer,Q),sessionStorage.getItem("sessionId")||sessionStorage.setItem("sessionId",window.location.href),!window.IntersectionObserver){const e=document.createElement("script");e.src=`${S.CDN_BASE_URL}/cdn/assets/okfe/libs/polyfills/intersection-observer.js`,document.getElementsByTagName("head")[0].appendChild(e)}window.utils=window.utils||{},window.utils.monitor=this.monitor}},saveChannelId(e){W(e)}};z.init();var H=z.monitor;return t=t.default}()}));
//# sourceMappingURL=index.js.map